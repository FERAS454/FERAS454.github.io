<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='This post explores some of PowerShell commands that I&rsquo;ve found invaluable for rapid triage during investigations.\nSystem Information System Info: 1 Get-ComputerInfo Process Management Running Processes: 1 Get-Process Kill Process by Name: 1 Stop-Process -Name "NameOfProcess" -Force List Running Processes, Parent Process, and Path: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 Get-WmiObject -Class Win32_Process | ForEach-Object { $processID = $_.ProcessID $parentProcessID = $_.ParentProcessID $parentProcess = Get-WmiObject -Class Win32_Process -Filter "ProcessID=&#39;$parentProcessID&#39;" [PSCustomObject]@{ ProcessName = $_.Name ProcessID = $processID ParentProcessName = $parentProcess.Name ExecutablePath = $_.ExecutablePath CommandLine = $_.CommandLine } } Generate Hashes of All Running Processes: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 Get-Process | ForEach-Object { try { $hash = Get-FileHash $_.Path -Algorithm SHA256 Write-Output "$($_.ProcessName), $hash" } catch { Write-Output "$($_.ProcessName), $_.Exception.Message" } } Network Information Network Connections: 1 Get-NetTCPConnection Get Listening Ports: 1 Get-NetTCPConnection -State Listen | Select-Object LocalAddress, LocalPort, OwningProcess, OwningProcessName ARP Table: 1 Get-NetNeighbor 1 Get-NetNeighbor | Where-Object {$_.State -eq &#39;Reachable&#39;} | Format-Table IPAddress, LinkLayerAddress, State Check for Open RDP Sessions 1 Get-WmiObject -Class Win32_Session | Where-Object {$_.SessionType -eq "RDP"} Check DNS Cache for Signs of DNS Hijacking 1 Get-DnsClientCache Get Active Network Shares 1 Get-SmbShare File System and Registry Traverse Filesystem: 1 2 Get-ChildItem [file] | Format-List * Get File Metadata: 1 2 Get-ItemProperty C:\\Test\\Weather.xls | Format-List File Hash Calculation: 1 2 Get-FileHash -Algorithm MD5 C:\\path\\to\\file Find Large Files: 1 2 gci -r | sort -descending -property length | select -first 10 name, length, directory Files Created or Modified Between Two Dates: 1 2 Get-ChildItem -Path "C:\\Path\\to\\folder" -Recurse | Where-Object {($_.CreationTime -ge (Get-Date "2023-06-11")) -and ($_.CreationTime -le (Get-Date "2023-06-22")) -or ($_.LastWriteTime -ge (Get-Date "2023-06-11")) -and ($_.LastWriteTime -le (Get-Date "2023-06-22"))} | Select-Object FullName, CreationTime, LastWriteTime Search for File by Hash: 1 2 Get-ChildItem -Path C:\\ -Recurse -File | Get-FileHash | Where-Object Hash -eq &#39;HASH_VALUE&#39; | Select-Object Path Search for File by Name: 1 2 Get-ChildItem -Path "C:\\Path\\To\\Search" -Filter "FileName" File Changed in Last 24 Hours: 1 2 Get-ChildItem -Path C:\\ -Recurse -File -Force | Where-Object { $_.LastWriteTime -ge (Get-Date).AddHours(-6) } Files Created in Last 24 Hours: 1 2 Get-ChildItem -Path C:\\ -Recurse -File -Force | Where-Object { $_.CreationTime -ge (Get-Date).AddHours(-6) } Obtain List of All Files: 1 2 3 4 tree C:\\ /F > output.txt dir C:\\ /A:H /-C /Q /R /S /X Delete Registry Key: 1 2 Remove-Item -Path "HKLM:\\Path\\To\\Registry\\Key" -Recurse Read Registry Key: 1 2 Get-ChildItem -Path &#39;HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\&#39; Retrieve Auto-Start Locations (Startup Programs) 1 Get-WmiObject -Query "SELECT * FROM Win32_StartupCommand" | Select-Object Name, Command, User List Installed Programs 1 Get-ItemProperty HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\* | Select-Object DisplayName, DisplayVersion, InstallDate Event Logs Search Sysmon Logs: 1 2 Get-WinEvent -FilterHashtable @{logname="Microsoft-Windows-Sysmon/Operational"; id=1} | Where-Object {$_.Properties[20].Value -like "*rdpclip*"} | fl Login History: 1 2 Get-WinEvent -FilterHashtable @{LogName=&#39;Security&#39;;ID=4624,4625} | Select-Object TimeCreated, Id, Message Search Event Logs by Keyword: 1 2 Get-WinEvent -FilterHashtable @{ LogName=&#39;Security&#39;;} | Select Timecreated,LogName,Message | Where {$_.Message -like "*test*"} | FL Convert EVTX to CSV: 1 2 Get-WinEvent -Path .\\Microsoft-Windows-Sysmon%4Operational.evtx | Export-CSV foo.csv User and Account Information Local Users Information: 1 2 Get-LocalUser | Select * Get the SID from a Given Username: 1 2 3 4 5 6 7 8 $username = "Domain\\Username" $account = New-Object System.Security.Principal.NTAccount($username) $sid = $account.Translate([System.Security.Principal.SecurityIdentifier]).Value Write-Output $sid Translate SIDs: 1 2 3 4 5 6 7 8 $SID = "S-1-5-21-329068152-1454471165-1417001333-12984448" $account = New-Object System.Security.Principal.SecurityIdentifier($SID) $username = $account.Translate([System.Security.Principal.NTAccount]).Value Write-Output $username Job and Task Management Scheduled Tasks: 1 2 Get-ScheduledTask | Where-Object { $_.State -eq &#39;Ready&#39; } 1 2 Get-ScheduledJob File Operations Copy File: 1 2 Copy-Item -Source \\\\server\\share\\test -Destination C:\\path\\ Download File from Internet: 1 2 Invoke-WebRequest -Uri "https://download.sysinternals.com/files/Sysmon.zip" -OutFile $env:TEMP\\sysmon.zip Unzip File: 1 2 Expand-Archive -Path <SourcePathofZipFile> -DestinationPath <DestinationPath> Encrypt File: 1 2 Read-Host -Prompt "Enter the encryption passphrase" -AsSecureString | ConvertFrom-SecureString | Set-Content -Path "C:\\Path\\EncryptedFile.txt" Web Operations Upload File to Web: 1 2 3 4 5 6 $filePath = "C:\\Path\\To\\File.txt" $uploadUrl = "http://example.com/upload" Invoke-RestMethod -Uri $uploadUrl -Method POST -InFile $filePath Miscellaneous Generate Random Data (10MB): 1 2 $fileSizeInMB = 10; $filePath = "$PWD\\file.txt"; $data = [byte[]]::new($fileSizeInMB * 1MB); $random = New-Object -TypeName System.Random; $random.NextBytes($data); [System.IO.File]::WriteAllBytes($filePath, $data) Regex Matching for Specific String (&ldquo;feras&rdquo;): 1 2 Select-String -Path C:\\path\\strings.txt -Pattern &#39;\\bferas\\b&#39; -AllMatches | % { $_.Matches } | % { $_.Value } Linux cut command\n'><title>Useful PowerShell Commands for Incident Response (IR) triage</title>
<link rel=canonical href=https://feras454.github.io/p/useful-powershell-commands-for-incident-response-ir-triage/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Useful PowerShell Commands for Incident Response (IR) triage"><meta property='og:description' content='This post explores some of PowerShell commands that I&rsquo;ve found invaluable for rapid triage during investigations.\nSystem Information System Info: 1 Get-ComputerInfo Process Management Running Processes: 1 Get-Process Kill Process by Name: 1 Stop-Process -Name "NameOfProcess" -Force List Running Processes, Parent Process, and Path: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 Get-WmiObject -Class Win32_Process | ForEach-Object { $processID = $_.ProcessID $parentProcessID = $_.ParentProcessID $parentProcess = Get-WmiObject -Class Win32_Process -Filter "ProcessID=&#39;$parentProcessID&#39;" [PSCustomObject]@{ ProcessName = $_.Name ProcessID = $processID ParentProcessName = $parentProcess.Name ExecutablePath = $_.ExecutablePath CommandLine = $_.CommandLine } } Generate Hashes of All Running Processes: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 Get-Process | ForEach-Object { try { $hash = Get-FileHash $_.Path -Algorithm SHA256 Write-Output "$($_.ProcessName), $hash" } catch { Write-Output "$($_.ProcessName), $_.Exception.Message" } } Network Information Network Connections: 1 Get-NetTCPConnection Get Listening Ports: 1 Get-NetTCPConnection -State Listen | Select-Object LocalAddress, LocalPort, OwningProcess, OwningProcessName ARP Table: 1 Get-NetNeighbor 1 Get-NetNeighbor | Where-Object {$_.State -eq &#39;Reachable&#39;} | Format-Table IPAddress, LinkLayerAddress, State Check for Open RDP Sessions 1 Get-WmiObject -Class Win32_Session | Where-Object {$_.SessionType -eq "RDP"} Check DNS Cache for Signs of DNS Hijacking 1 Get-DnsClientCache Get Active Network Shares 1 Get-SmbShare File System and Registry Traverse Filesystem: 1 2 Get-ChildItem [file] | Format-List * Get File Metadata: 1 2 Get-ItemProperty C:\\Test\\Weather.xls | Format-List File Hash Calculation: 1 2 Get-FileHash -Algorithm MD5 C:\\path\\to\\file Find Large Files: 1 2 gci -r | sort -descending -property length | select -first 10 name, length, directory Files Created or Modified Between Two Dates: 1 2 Get-ChildItem -Path "C:\\Path\\to\\folder" -Recurse | Where-Object {($_.CreationTime -ge (Get-Date "2023-06-11")) -and ($_.CreationTime -le (Get-Date "2023-06-22")) -or ($_.LastWriteTime -ge (Get-Date "2023-06-11")) -and ($_.LastWriteTime -le (Get-Date "2023-06-22"))} | Select-Object FullName, CreationTime, LastWriteTime Search for File by Hash: 1 2 Get-ChildItem -Path C:\\ -Recurse -File | Get-FileHash | Where-Object Hash -eq &#39;HASH_VALUE&#39; | Select-Object Path Search for File by Name: 1 2 Get-ChildItem -Path "C:\\Path\\To\\Search" -Filter "FileName" File Changed in Last 24 Hours: 1 2 Get-ChildItem -Path C:\\ -Recurse -File -Force | Where-Object { $_.LastWriteTime -ge (Get-Date).AddHours(-6) } Files Created in Last 24 Hours: 1 2 Get-ChildItem -Path C:\\ -Recurse -File -Force | Where-Object { $_.CreationTime -ge (Get-Date).AddHours(-6) } Obtain List of All Files: 1 2 3 4 tree C:\\ /F > output.txt dir C:\\ /A:H /-C /Q /R /S /X Delete Registry Key: 1 2 Remove-Item -Path "HKLM:\\Path\\To\\Registry\\Key" -Recurse Read Registry Key: 1 2 Get-ChildItem -Path &#39;HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\&#39; Retrieve Auto-Start Locations (Startup Programs) 1 Get-WmiObject -Query "SELECT * FROM Win32_StartupCommand" | Select-Object Name, Command, User List Installed Programs 1 Get-ItemProperty HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\* | Select-Object DisplayName, DisplayVersion, InstallDate Event Logs Search Sysmon Logs: 1 2 Get-WinEvent -FilterHashtable @{logname="Microsoft-Windows-Sysmon/Operational"; id=1} | Where-Object {$_.Properties[20].Value -like "*rdpclip*"} | fl Login History: 1 2 Get-WinEvent -FilterHashtable @{LogName=&#39;Security&#39;;ID=4624,4625} | Select-Object TimeCreated, Id, Message Search Event Logs by Keyword: 1 2 Get-WinEvent -FilterHashtable @{ LogName=&#39;Security&#39;;} | Select Timecreated,LogName,Message | Where {$_.Message -like "*test*"} | FL Convert EVTX to CSV: 1 2 Get-WinEvent -Path .\\Microsoft-Windows-Sysmon%4Operational.evtx | Export-CSV foo.csv User and Account Information Local Users Information: 1 2 Get-LocalUser | Select * Get the SID from a Given Username: 1 2 3 4 5 6 7 8 $username = "Domain\\Username" $account = New-Object System.Security.Principal.NTAccount($username) $sid = $account.Translate([System.Security.Principal.SecurityIdentifier]).Value Write-Output $sid Translate SIDs: 1 2 3 4 5 6 7 8 $SID = "S-1-5-21-329068152-1454471165-1417001333-12984448" $account = New-Object System.Security.Principal.SecurityIdentifier($SID) $username = $account.Translate([System.Security.Principal.NTAccount]).Value Write-Output $username Job and Task Management Scheduled Tasks: 1 2 Get-ScheduledTask | Where-Object { $_.State -eq &#39;Ready&#39; } 1 2 Get-ScheduledJob File Operations Copy File: 1 2 Copy-Item -Source \\\\server\\share\\test -Destination C:\\path\\ Download File from Internet: 1 2 Invoke-WebRequest -Uri "https://download.sysinternals.com/files/Sysmon.zip" -OutFile $env:TEMP\\sysmon.zip Unzip File: 1 2 Expand-Archive -Path <SourcePathofZipFile> -DestinationPath <DestinationPath> Encrypt File: 1 2 Read-Host -Prompt "Enter the encryption passphrase" -AsSecureString | ConvertFrom-SecureString | Set-Content -Path "C:\\Path\\EncryptedFile.txt" Web Operations Upload File to Web: 1 2 3 4 5 6 $filePath = "C:\\Path\\To\\File.txt" $uploadUrl = "http://example.com/upload" Invoke-RestMethod -Uri $uploadUrl -Method POST -InFile $filePath Miscellaneous Generate Random Data (10MB): 1 2 $fileSizeInMB = 10; $filePath = "$PWD\\file.txt"; $data = [byte[]]::new($fileSizeInMB * 1MB); $random = New-Object -TypeName System.Random; $random.NextBytes($data); [System.IO.File]::WriteAllBytes($filePath, $data) Regex Matching for Specific String (&ldquo;feras&rdquo;): 1 2 Select-String -Path C:\\path\\strings.txt -Pattern &#39;\\bferas\\b&#39; -AllMatches | % { $_.Matches } | % { $_.Value } Linux cut command\n'><meta property='og:url' content='https://feras454.github.io/p/useful-powershell-commands-for-incident-response-ir-triage/'><meta property='og:site_name' content='Feras Jalalah'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2024-07-07T00:00:00+00:00'><meta property='article:modified_time' content='2024-07-07T00:00:00+00:00'><meta property='og:image' content='https://feras454.github.io/p/useful-powershell-commands-for-incident-response-ir-triage/powershell.webp'><meta name=twitter:title content="Useful PowerShell Commands for Incident Response (IR) triage"><meta name=twitter:description content='This post explores some of PowerShell commands that I&rsquo;ve found invaluable for rapid triage during investigations.\nSystem Information System Info: 1 Get-ComputerInfo Process Management Running Processes: 1 Get-Process Kill Process by Name: 1 Stop-Process -Name "NameOfProcess" -Force List Running Processes, Parent Process, and Path: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 Get-WmiObject -Class Win32_Process | ForEach-Object { $processID = $_.ProcessID $parentProcessID = $_.ParentProcessID $parentProcess = Get-WmiObject -Class Win32_Process -Filter "ProcessID=&#39;$parentProcessID&#39;" [PSCustomObject]@{ ProcessName = $_.Name ProcessID = $processID ParentProcessName = $parentProcess.Name ExecutablePath = $_.ExecutablePath CommandLine = $_.CommandLine } } Generate Hashes of All Running Processes: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 Get-Process | ForEach-Object { try { $hash = Get-FileHash $_.Path -Algorithm SHA256 Write-Output "$($_.ProcessName), $hash" } catch { Write-Output "$($_.ProcessName), $_.Exception.Message" } } Network Information Network Connections: 1 Get-NetTCPConnection Get Listening Ports: 1 Get-NetTCPConnection -State Listen | Select-Object LocalAddress, LocalPort, OwningProcess, OwningProcessName ARP Table: 1 Get-NetNeighbor 1 Get-NetNeighbor | Where-Object {$_.State -eq &#39;Reachable&#39;} | Format-Table IPAddress, LinkLayerAddress, State Check for Open RDP Sessions 1 Get-WmiObject -Class Win32_Session | Where-Object {$_.SessionType -eq "RDP"} Check DNS Cache for Signs of DNS Hijacking 1 Get-DnsClientCache Get Active Network Shares 1 Get-SmbShare File System and Registry Traverse Filesystem: 1 2 Get-ChildItem [file] | Format-List * Get File Metadata: 1 2 Get-ItemProperty C:\\Test\\Weather.xls | Format-List File Hash Calculation: 1 2 Get-FileHash -Algorithm MD5 C:\\path\\to\\file Find Large Files: 1 2 gci -r | sort -descending -property length | select -first 10 name, length, directory Files Created or Modified Between Two Dates: 1 2 Get-ChildItem -Path "C:\\Path\\to\\folder" -Recurse | Where-Object {($_.CreationTime -ge (Get-Date "2023-06-11")) -and ($_.CreationTime -le (Get-Date "2023-06-22")) -or ($_.LastWriteTime -ge (Get-Date "2023-06-11")) -and ($_.LastWriteTime -le (Get-Date "2023-06-22"))} | Select-Object FullName, CreationTime, LastWriteTime Search for File by Hash: 1 2 Get-ChildItem -Path C:\\ -Recurse -File | Get-FileHash | Where-Object Hash -eq &#39;HASH_VALUE&#39; | Select-Object Path Search for File by Name: 1 2 Get-ChildItem -Path "C:\\Path\\To\\Search" -Filter "FileName" File Changed in Last 24 Hours: 1 2 Get-ChildItem -Path C:\\ -Recurse -File -Force | Where-Object { $_.LastWriteTime -ge (Get-Date).AddHours(-6) } Files Created in Last 24 Hours: 1 2 Get-ChildItem -Path C:\\ -Recurse -File -Force | Where-Object { $_.CreationTime -ge (Get-Date).AddHours(-6) } Obtain List of All Files: 1 2 3 4 tree C:\\ /F > output.txt dir C:\\ /A:H /-C /Q /R /S /X Delete Registry Key: 1 2 Remove-Item -Path "HKLM:\\Path\\To\\Registry\\Key" -Recurse Read Registry Key: 1 2 Get-ChildItem -Path &#39;HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\WindowsUpdate\\&#39; Retrieve Auto-Start Locations (Startup Programs) 1 Get-WmiObject -Query "SELECT * FROM Win32_StartupCommand" | Select-Object Name, Command, User List Installed Programs 1 Get-ItemProperty HKLM:\\Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\* | Select-Object DisplayName, DisplayVersion, InstallDate Event Logs Search Sysmon Logs: 1 2 Get-WinEvent -FilterHashtable @{logname="Microsoft-Windows-Sysmon/Operational"; id=1} | Where-Object {$_.Properties[20].Value -like "*rdpclip*"} | fl Login History: 1 2 Get-WinEvent -FilterHashtable @{LogName=&#39;Security&#39;;ID=4624,4625} | Select-Object TimeCreated, Id, Message Search Event Logs by Keyword: 1 2 Get-WinEvent -FilterHashtable @{ LogName=&#39;Security&#39;;} | Select Timecreated,LogName,Message | Where {$_.Message -like "*test*"} | FL Convert EVTX to CSV: 1 2 Get-WinEvent -Path .\\Microsoft-Windows-Sysmon%4Operational.evtx | Export-CSV foo.csv User and Account Information Local Users Information: 1 2 Get-LocalUser | Select * Get the SID from a Given Username: 1 2 3 4 5 6 7 8 $username = "Domain\\Username" $account = New-Object System.Security.Principal.NTAccount($username) $sid = $account.Translate([System.Security.Principal.SecurityIdentifier]).Value Write-Output $sid Translate SIDs: 1 2 3 4 5 6 7 8 $SID = "S-1-5-21-329068152-1454471165-1417001333-12984448" $account = New-Object System.Security.Principal.SecurityIdentifier($SID) $username = $account.Translate([System.Security.Principal.NTAccount]).Value Write-Output $username Job and Task Management Scheduled Tasks: 1 2 Get-ScheduledTask | Where-Object { $_.State -eq &#39;Ready&#39; } 1 2 Get-ScheduledJob File Operations Copy File: 1 2 Copy-Item -Source \\\\server\\share\\test -Destination C:\\path\\ Download File from Internet: 1 2 Invoke-WebRequest -Uri "https://download.sysinternals.com/files/Sysmon.zip" -OutFile $env:TEMP\\sysmon.zip Unzip File: 1 2 Expand-Archive -Path <SourcePathofZipFile> -DestinationPath <DestinationPath> Encrypt File: 1 2 Read-Host -Prompt "Enter the encryption passphrase" -AsSecureString | ConvertFrom-SecureString | Set-Content -Path "C:\\Path\\EncryptedFile.txt" Web Operations Upload File to Web: 1 2 3 4 5 6 $filePath = "C:\\Path\\To\\File.txt" $uploadUrl = "http://example.com/upload" Invoke-RestMethod -Uri $uploadUrl -Method POST -InFile $filePath Miscellaneous Generate Random Data (10MB): 1 2 $fileSizeInMB = 10; $filePath = "$PWD\\file.txt"; $data = [byte[]]::new($fileSizeInMB * 1MB); $random = New-Object -TypeName System.Random; $random.NextBytes($data); [System.IO.File]::WriteAllBytes($filePath, $data) Regex Matching for Specific String (&ldquo;feras&rdquo;): 1 2 Select-String -Path C:\\path\\strings.txt -Pattern &#39;\\bferas\\b&#39; -AllMatches | % { $_.Matches } | % { $_.Value } Linux cut command\n'><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://feras454.github.io/p/useful-powershell-commands-for-incident-response-ir-triage/powershell.webp'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu12637548636728576105.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Feras Jalalah</a></h1><h2 class=site-description>Interested in DFIR, SOC, Threat Hunting, and Threat Intel.</h2></div></header><ol class=menu-social><li><a href=https://twitter.com/Feras_454 target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>About</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#system-information>System Information</a></li><li><a href=#process-management>Process Management</a></li><li><a href=#network-information>Network Information</a></li><li><a href=#file-system-and-registry>File System and Registry</a></li><li><a href=#event-logs>Event Logs</a></li><li><a href=#user-and-account-information>User and Account Information</a></li><li><a href=#job-and-task-management>Job and Task Management</a></li><li><a href=#file-operations>File Operations</a></li><li><a href=#web-operations>Web Operations</a></li><li><a href=#miscellaneous>Miscellaneous</a></li><li><a href=#powershell-with-security-utilities>PowerShell with Security Utilities</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/useful-powershell-commands-for-incident-response-ir-triage/><img src=/p/useful-powershell-commands-for-incident-response-ir-triage/powershell_hu14937614042534575624.webp srcset="/p/useful-powershell-commands-for-incident-response-ir-triage/powershell_hu14937614042534575624.webp 800w, /p/useful-powershell-commands-for-incident-response-ir-triage/powershell_hu471584958689176413.webp 1600w" width=800 height=500 loading=lazy alt="Featured image of post Useful PowerShell Commands for Incident Response (IR) triage"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/useful-powershell-commands-for-incident-response-ir-triage/>Useful PowerShell Commands for Incident Response (IR) triage</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jul 07, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>4 minute read</time></div></footer></div></header><section class=article-content><p><strong>This post explores some of PowerShell commands that I&rsquo;ve found invaluable for rapid triage during investigations.</strong></p><hr><h2 id=system-information>System Information</h2><ul><li><strong>System Info</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-ComputerInfo</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=process-management>Process Management</h2><ul><li><strong>Running Processes</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-Process</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Kill Process by Name</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Stop-Process</span> <span class=n>-Name</span> <span class=s2>&#34;NameOfProcess&#34;</span> <span class=n>-Force</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>List Running Processes, Parent Process, and Path</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-WmiObject</span> <span class=n>-Class</span> <span class=n>Win32_Process</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$processID</span> <span class=p>=</span> <span class=nv>$_</span><span class=p>.</span><span class=py>ProcessID</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$parentProcessID</span> <span class=p>=</span> <span class=nv>$_</span><span class=p>.</span><span class=py>ParentProcessID</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$parentProcess</span> <span class=p>=</span> <span class=nb>Get-WmiObject</span> <span class=n>-Class</span> <span class=n>Win32_Process</span> <span class=n>-Filter</span> <span class=s2>&#34;ProcessID=&#39;</span><span class=nv>$parentProcessID</span><span class=s2>&#39;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=no>PSCustomObject</span><span class=p>]</span><span class=vm>@</span><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ProcessName</span> <span class=p>=</span> <span class=nv>$_</span><span class=p>.</span><span class=py>Name</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ProcessID</span> <span class=p>=</span> <span class=nv>$processID</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ParentProcessName</span> <span class=p>=</span> <span class=nv>$parentProcess</span><span class=p>.</span><span class=py>Name</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ExecutablePath</span> <span class=p>=</span> <span class=nv>$_</span><span class=p>.</span><span class=py>ExecutablePath</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>CommandLine</span> <span class=p>=</span> <span class=nv>$_</span><span class=p>.</span><span class=py>CommandLine</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Generate Hashes of All Running Processes</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-Process</span> <span class=p>|</span> <span class=nb>ForEach-Object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nv>$hash</span> <span class=p>=</span> <span class=nb>Get-FileHash</span> <span class=nv>$_</span><span class=p>.</span><span class=py>Path</span> <span class=n>-Algorithm</span> <span class=n>SHA256</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Output</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$_</span><span class=p>.</span><span class=n>ProcessName</span><span class=p>)</span><span class=s2>, </span><span class=nv>$hash</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>catch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Output</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$_</span><span class=p>.</span><span class=n>ProcessName</span><span class=p>)</span><span class=s2>, </span><span class=nv>$_</span><span class=s2>.Exception.Message&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=network-information>Network Information</h2><ul><li><strong>Network Connections</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetTCPConnection</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Get Listening Ports</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetTCPConnection</span> <span class=n>-State</span> <span class=n>Listen</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>LocalAddress</span><span class=p>,</span> <span class=n>LocalPort</span><span class=p>,</span> <span class=n>OwningProcess</span><span class=p>,</span> <span class=n>OwningProcessName</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>ARP Table</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetNeighbor</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-NetNeighbor</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span><span class=nv>$_</span><span class=p>.</span><span class=py>State</span> <span class=o>-eq</span> <span class=s1>&#39;Reachable&#39;</span><span class=p>}</span> <span class=p>|</span> <span class=nb>Format-Table</span> <span class=n>IPAddress</span><span class=p>,</span> <span class=n>LinkLayerAddress</span><span class=p>,</span> <span class=n>State</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Check for Open RDP Sessions</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-WmiObject</span> <span class=n>-Class</span> <span class=n>Win32_Session</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span><span class=nv>$_</span><span class=p>.</span><span class=py>SessionType</span> <span class=o>-eq</span> <span class=s2>&#34;RDP&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Check DNS Cache for Signs of DNS Hijacking</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-DnsClientCache</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Get Active Network Shares</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-SmbShare</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=file-system-and-registry>File System and Registry</h2><ul><li><strong>Traverse Filesystem</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-ChildItem</span> <span class=p>[</span><span class=no>file</span><span class=p>]</span> <span class=p>|</span> <span class=nb>Format-List</span> <span class=p>*</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Get File Metadata</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-ItemProperty</span> <span class=n>C:</span><span class=p>\</span><span class=n>Test</span><span class=p>\</span><span class=n>Weather</span><span class=p>.</span><span class=py>xls</span> <span class=p>|</span> <span class=nb>Format-List</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>File Hash Calculation</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-FileHash</span> <span class=n>-Algorithm</span> <span class=n>MD5</span> <span class=n>C:</span><span class=p>\</span><span class=n>path</span><span class=p>\</span><span class=n>to</span><span class=p>\</span><span class=n>file</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Find Large Files</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>gci </span><span class=n>-r</span> <span class=p>|</span> <span class=nb>sort </span><span class=n>-descending</span> <span class=n>-property</span> <span class=n>length</span> <span class=p>|</span> <span class=nb>select </span><span class=n>-first</span> <span class=mf>10</span> <span class=n>name</span><span class=p>,</span> <span class=n>length</span><span class=p>,</span> <span class=n>directory</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Files Created or Modified Between Two Dates</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-ChildItem</span> <span class=n>-Path</span> <span class=s2>&#34;C:\Path\to\folder&#34;</span> <span class=n>-Recurse</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{(</span><span class=nv>$_</span><span class=p>.</span><span class=py>CreationTime</span> <span class=o>-ge</span> <span class=p>(</span><span class=nb>Get-Date</span> <span class=s2>&#34;2023-06-11&#34;</span><span class=p>))</span> <span class=o>-and</span> <span class=p>(</span><span class=nv>$_</span><span class=p>.</span><span class=py>CreationTime</span> <span class=o>-le</span> <span class=p>(</span><span class=nb>Get-Date</span> <span class=s2>&#34;2023-06-22&#34;</span><span class=p>))</span> <span class=o>-or</span> <span class=p>(</span><span class=nv>$_</span><span class=p>.</span><span class=py>LastWriteTime</span> <span class=o>-ge</span> <span class=p>(</span><span class=nb>Get-Date</span> <span class=s2>&#34;2023-06-11&#34;</span><span class=p>))</span> <span class=o>-and</span> <span class=p>(</span><span class=nv>$_</span><span class=p>.</span><span class=py>LastWriteTime</span> <span class=o>-le</span> <span class=p>(</span><span class=nb>Get-Date</span> <span class=s2>&#34;2023-06-22&#34;</span><span class=p>))}</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>FullName</span><span class=p>,</span> <span class=n>CreationTime</span><span class=p>,</span> <span class=n>LastWriteTime</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Search for File by Hash</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-ChildItem</span> <span class=n>-Path</span> <span class=n>C:</span><span class=p>\</span> <span class=n>-Recurse</span> <span class=o>-File</span> <span class=p>|</span> <span class=nb>Get-FileHash</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=n>Hash</span> <span class=o>-eq</span> <span class=s1>&#39;HASH_VALUE&#39;</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>Path</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Search for File by Name</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-ChildItem</span> <span class=n>-Path</span> <span class=s2>&#34;C:\Path\To\Search&#34;</span> <span class=n>-Filter</span> <span class=s2>&#34;FileName&#34;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>File Changed in Last 24 Hours</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-ChildItem</span> <span class=n>-Path</span> <span class=n>C:</span><span class=p>\</span> <span class=n>-Recurse</span> <span class=o>-File</span> <span class=n>-Force</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=nv>$_</span><span class=p>.</span><span class=py>LastWriteTime</span> <span class=o>-ge</span> <span class=p>(</span><span class=nb>Get-Date</span><span class=p>).</span><span class=py>AddHours</span><span class=p>(</span><span class=mf>-6</span><span class=p>)</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Files Created in Last 24 Hours</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-ChildItem</span> <span class=n>-Path</span> <span class=n>C:</span><span class=p>\</span> <span class=n>-Recurse</span> <span class=o>-File</span> <span class=n>-Force</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=nv>$_</span><span class=p>.</span><span class=py>CreationTime</span> <span class=o>-ge</span> <span class=p>(</span><span class=nb>Get-Date</span><span class=p>).</span><span class=py>AddHours</span><span class=p>(</span><span class=mf>-6</span><span class=p>)</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Obtain List of All Files</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>tree</span> <span class=n>C:</span><span class=p>\</span> <span class=p>/</span><span class=n>F</span> <span class=p>&gt;</span> <span class=n>output</span><span class=p>.</span><span class=py>txt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>dir </span><span class=n>C:</span><span class=p>\</span> <span class=p>/</span><span class=n>A:</span><span class=nb>H </span><span class=p>/</span><span class=n>-C</span> <span class=p>/</span><span class=n>Q</span> <span class=p>/</span><span class=nb>R </span><span class=p>/</span><span class=n>S</span> <span class=p>/</span><span class=n>X</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Delete Registry Key</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Remove-Item</span> <span class=n>-Path</span> <span class=s2>&#34;HKLM:\Path\To\Registry\Key&#34;</span> <span class=n>-Recurse</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Read Registry Key</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-ChildItem</span> <span class=n>-Path</span> <span class=s1>&#39;HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\&#39;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Retrieve Auto-Start Locations (Startup Programs)</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-WmiObject</span> <span class=n>-Query</span> <span class=s2>&#34;SELECT * FROM Win32_StartupCommand&#34;</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>Name</span><span class=p>,</span> <span class=n>Command</span><span class=p>,</span> <span class=n>User</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>List Installed Programs</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-ItemProperty</span> <span class=n>HKLM</span><span class=err>:</span><span class=p>\</span><span class=n>Software</span><span class=p>\</span><span class=n>Microsoft</span><span class=p>\</span><span class=n>Windows</span><span class=p>\</span><span class=n>CurrentVersion</span><span class=p>\</span><span class=n>Uninstall</span><span class=p>\*</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>DisplayName</span><span class=p>,</span> <span class=n>DisplayVersion</span><span class=p>,</span> <span class=n>InstallDate</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=event-logs>Event Logs</h2><ul><li><strong>Search Sysmon Logs</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-WinEvent</span> <span class=n>-FilterHashtable</span> <span class=vm>@</span><span class=p>{</span><span class=n>logname</span><span class=p>=</span><span class=s2>&#34;Microsoft-Windows-Sysmon/Operational&#34;</span><span class=p>;</span> <span class=n>id</span><span class=p>=</span><span class=mf>1</span><span class=p>}</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span><span class=nv>$_</span><span class=p>.</span><span class=n>Properties</span><span class=p>[</span><span class=mf>20</span><span class=p>].</span><span class=py>Value</span> <span class=o>-like</span> <span class=s2>&#34;*rdpclip*&#34;</span><span class=p>}</span> <span class=p>|</span> <span class=nb>fl
</span></span></span></code></pre></td></tr></table></div></div><ul><li><strong>Login History</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-WinEvent</span> <span class=n>-FilterHashtable</span> <span class=vm>@</span><span class=p>{</span><span class=n>LogName</span><span class=p>=</span><span class=s1>&#39;Security&#39;</span><span class=p>;</span><span class=n>ID</span><span class=p>=</span><span class=mf>4624</span><span class=p>,</span><span class=mf>4625</span><span class=p>}</span> <span class=p>|</span> <span class=nb>Select-Object</span> <span class=n>TimeCreated</span><span class=p>,</span> <span class=n>Id</span><span class=p>,</span> <span class=n>Message</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Search Event Logs by Keyword</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-WinEvent</span> <span class=n>-FilterHashtable</span> <span class=vm>@</span><span class=p>{</span> <span class=n>LogName</span><span class=p>=</span><span class=s1>&#39;Security&#39;</span><span class=p>;}</span> <span class=p>|</span> <span class=nb>Select </span><span class=n>Timecreated</span><span class=p>,</span><span class=n>LogName</span><span class=p>,</span><span class=n>Message</span> <span class=p>|</span> <span class=nb>Where </span><span class=p>{</span><span class=nv>$_</span><span class=p>.</span><span class=py>Message</span> <span class=o>-like</span> <span class=s2>&#34;*test*&#34;</span><span class=p>}</span> <span class=p>|</span> <span class=nb>FL
</span></span></span></code></pre></td></tr></table></div></div><ul><li><strong>Convert EVTX to CSV</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-WinEvent</span> <span class=n>-Path</span> <span class=p>.\</span><span class=nb>Microsoft-Windows</span><span class=n>-Sysmon</span><span class=k>%</span><span class=n>4Operational</span><span class=p>.</span><span class=py>evtx</span> <span class=p>|</span> <span class=nb>Export-CSV</span> <span class=n>foo</span><span class=p>.</span><span class=py>csv</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=user-and-account-information>User and Account Information</h2><ul><li><strong>Local Users Information</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-LocalUser</span> <span class=p>|</span> <span class=nb>Select </span><span class=p>*</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Get the SID from a Given Username</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$username</span> <span class=p>=</span> <span class=s2>&#34;Domain\Username&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$account</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Security</span><span class=p>.</span><span class=py>Principal</span><span class=p>.</span><span class=py>NTAccount</span><span class=p>(</span><span class=nv>$username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$sid</span> <span class=p>=</span> <span class=nv>$account</span><span class=p>.</span><span class=py>Translate</span><span class=p>([</span><span class=no>System.Security.Principal.SecurityIdentifier</span><span class=p>]).</span><span class=py>Value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Write-Output</span> <span class=nv>$sid</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Translate SIDs</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$SID</span> <span class=p>=</span> <span class=s2>&#34;S-1-5-21-329068152-1454471165-1417001333-12984448&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$account</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>System</span><span class=p>.</span><span class=py>Security</span><span class=p>.</span><span class=py>Principal</span><span class=p>.</span><span class=py>SecurityIdentifier</span><span class=p>(</span><span class=nv>$SID</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$username</span> <span class=p>=</span> <span class=nv>$account</span><span class=p>.</span><span class=py>Translate</span><span class=p>([</span><span class=no>System.Security.Principal.NTAccount</span><span class=p>]).</span><span class=py>Value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Write-Output</span> <span class=nv>$username</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=job-and-task-management>Job and Task Management</h2><ul><li><strong>Scheduled Tasks</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-ScheduledTask</span> <span class=p>|</span> <span class=nb>Where-Object</span> <span class=p>{</span> <span class=nv>$_</span><span class=p>.</span><span class=py>State</span> <span class=o>-eq</span> <span class=s1>&#39;Ready&#39;</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Get-ScheduledJob</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=file-operations>File Operations</h2><ul><li><strong>Copy File</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Copy-Item</span> <span class=n>-Source</span> <span class=p>\\</span><span class=n>server</span><span class=p>\</span><span class=n>share</span><span class=p>\</span><span class=n>test</span> <span class=n>-Destination</span> <span class=n>C:</span><span class=p>\</span><span class=n>path</span><span class=p>\</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Download File from Internet</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Invoke-WebRequest</span> <span class=n>-Uri</span> <span class=s2>&#34;https://download.sysinternals.com/files/Sysmon.zip&#34;</span> <span class=n>-OutFile</span> <span class=nv>$env:TEMP</span><span class=p>\</span><span class=n>sysmon</span><span class=p>.</span><span class=py>zip</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Unzip File</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Expand-Archive</span> <span class=n>-Path</span> <span class=p>&lt;</span><span class=n>SourcePathofZipFile</span><span class=p>&gt;</span> <span class=n>-DestinationPath</span> <span class=p>&lt;</span><span class=n>DestinationPath</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Encrypt File</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Read-Host</span> <span class=n>-Prompt</span> <span class=s2>&#34;Enter the encryption passphrase&#34;</span> <span class=n>-AsSecureString</span> <span class=p>|</span> <span class=nb>ConvertFrom-SecureString</span> <span class=p>|</span> <span class=nb>Set-Content</span> <span class=n>-Path</span> <span class=s2>&#34;C:\Path\EncryptedFile.txt&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=web-operations>Web Operations</h2><ul><li><strong>Upload File to Web</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$filePath</span> <span class=p>=</span> <span class=s2>&#34;C:\Path\To\File.txt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$uploadUrl</span> <span class=p>=</span> <span class=s2>&#34;http://example.com/upload&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Invoke-RestMethod</span> <span class=n>-Uri</span> <span class=nv>$uploadUrl</span> <span class=n>-Method</span> <span class=n>POST</span> <span class=n>-InFile</span> <span class=nv>$filePath</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=miscellaneous>Miscellaneous</h2><ul><li><strong>Generate Random Data (10MB)</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$fileSizeInMB</span> <span class=p>=</span> <span class=mf>10</span><span class=p>;</span> <span class=nv>$filePath</span> <span class=p>=</span> <span class=s2>&#34;</span><span class=nv>$PWD</span><span class=s2>\file.txt&#34;</span><span class=p>;</span> <span class=nv>$data</span> <span class=p>=</span> <span class=p>[</span><span class=no>byte[]</span><span class=p>]::</span><span class=n>new</span><span class=p>(</span><span class=nv>$fileSizeInMB</span> <span class=p>*</span> <span class=mf>1</span><span class=p>MB);</span> <span class=nv>$random</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>-TypeName</span> <span class=n>System</span><span class=p>.</span><span class=n>Random</span><span class=p>;</span> <span class=nv>$random</span><span class=p>.</span><span class=py>NextBytes</span><span class=p>(</span><span class=nv>$data</span><span class=p>);</span> <span class=p>[</span><span class=no>System.IO.File</span><span class=p>]::</span><span class=n>WriteAllBytes</span><span class=p>(</span><span class=nv>$filePath</span><span class=p>,</span> <span class=nv>$data</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><strong>Regex Matching for Specific String (&ldquo;feras&rdquo;)</strong>:  </li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Select-String</span> <span class=n>-Path</span> <span class=n>C:</span><span class=p>\</span><span class=n>path</span><span class=p>\</span><span class=n>strings</span><span class=p>.</span><span class=py>txt</span> <span class=n>-Pattern</span> <span class=s1>&#39;\bferas\b&#39;</span> <span class=n>-AllMatches</span> <span class=p>|</span> <span class=p>%</span> <span class=p>{</span> <span class=nv>$_</span><span class=p>.</span><span class=py>Matches</span> <span class=p>}</span> <span class=p>|</span> <span class=p>%</span> <span class=p>{</span> <span class=nv>$_</span><span class=p>.</span><span class=py>Value</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>Linux cut command</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Cut</span> <span class=kd>function</span><span class=w> </span><span class=nb>powershell</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span><span class=w> </span><span class=nb>cut</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>param</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>ValueFromPipeline</span><span class=p>=</span><span class=vm>$True</span><span class=p>)]</span> <span class=p>[</span><span class=no>string</span><span class=p>]</span><span class=nv>$inputobject</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=no>string</span><span class=p>]</span><span class=nv>$delimiter</span><span class=p>=</span><span class=s1>&#39;\s+&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=no>string[]</span><span class=p>]</span><span class=nv>$field</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>process</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$field</span> <span class=o>-eq</span> <span class=vm>$null</span><span class=p>)</span> <span class=p>{</span> <span class=nv>$inputobject</span> <span class=n>-split</span> <span class=nv>$delimiter</span> <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nv>$inputobject</span> <span class=n>-split</span> <span class=nv>$delimiter</span><span class=p>)[</span><span class=nv>$field</span><span class=p>]</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=powershell-with-security-utilities>PowerShell with Security Utilities</h2><p>PowerShell enhances security utilities like Sysinternals for effective IR:</p><ul><li><p><strong>Sysinternals</strong>: Start utilities like Process Explorer:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Start-Process</span> <span class=s2>&#34;C:\Path\To\ProcessExplorer.exe&#34;</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>Remote Commands</strong>: Use PsExec to run commands on target machines:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>PsExec</span><span class=p>.</span><span class=py>exe</span> <span class=p>\\</span><span class=n>TargetMachine</span> <span class=n>cmd</span>
</span></span></code></pre></td></tr></table></div></div></li><li><p><strong>Data Collection</strong>: Retrieve logs from Sysmon:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-WinEvent</span> <span class=n>-LogName</span> <span class=s1>&#39;Microsoft-Windows-Sysmon/Operational&#39;</span>
</span></span></code></pre></td></tr></table></div></div></li></ul><hr><p><img src=/p/useful-powershell-commands-for-incident-response-ir-triage/power.jpg width=461 height=403 srcset="/p/useful-powershell-commands-for-incident-response-ir-triage/power_hu11706779164612263903.jpg 480w, /p/useful-powershell-commands-for-incident-response-ir-triage/power_hu6829873296058121097.jpg 1024w" loading=lazy class=gallery-image data-flex-grow=114 data-flex-basis=274px></p></section><footer class=article-footer></footer></article><footer class=site-footer><section class=copyright>&copy;
2024 Feras Jalalah</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>